<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>골프 머니 & 스트로크 계산기</title>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 16px; }
    h1 { font-size: 20px; margin-bottom: 8px; }
    .names { margin-bottom: 10px; }
    .names input { width: 100px; margin-right: 6px; }
    table { border-collapse: collapse; width: 100%; max-width: 1200px; font-size: 12px; }
    th, td { border: 1px solid #ccc; padding: 4px; text-align: center; }
    th { background: #f0f0f0; }
    input[type="number"] { width: 60px; }
    .totals { margin-top: 12px; max-width: 750px; }
    .totals td, .totals th { border: 1px solid #ccc; padding: 4px; text-align: center; }
    .controls { margin-bottom: 10px; display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
    .controls label { font-size: 12px; }
    .note { font-size: 11px; color: #555; margin-top: 8px; line-height: 1.4; }
  </style>
</head>
<body id="captureArea">

<h1>골프 머니 & 스트로크 게임 계산기 (자동 계산)</h1>

<div class="names">
  플레이어 이름 :
  <input id="nameA" placeholder="A 이름" value="A">
  <input id="nameB" placeholder="B 이름" value="B">
  <input id="nameC" placeholder="C 이름" value="C">
  <input id="nameD" placeholder="D 이름" value="D">
</div>

<div class="controls">
  <label>기본 타당($):
    <input type="number" id="baseStake" value="2" step="0.5">
  </label>
  <label>특수홀 배율(x):
    <input type="number" id="rateMultiplier" value="2" step="0.5">
  </label>
  <label>버디 보너스($):
    <input type="number" id="birdieBonus" value="5" step="1">
  </label>
  <label>이글 보너스($):
    <input type="number" id="eagleBonus" value="20" step="1">
  </label>
  <label>스킨 값($):
    <input type="number" id="skinValue" value="2" step="0.5">
  </label>
  <button onclick="calcAll()">다시 계산</button>
  <button onclick="takeScreenshot()">결과 스크린샷</button>
  <button onclick="toggleFullscreen()">전체 화면</button>
</div>

<table>
  <thead>
    <tr>
      <th>Hole</th>
      <th>Par</th>
      <th id="thA">A</th>
      <th id="thB">B</th>
      <th id="thC">C</th>
      <th id="thD">D</th>
      <th>Rate($/타)</th>
      <th id="thNetA">A Net</th>
      <th id="thNetB">B Net</th>
      <th id="thNetC">C Net</th>
      <th id="thNetD">D Net</th>
      <th>이 홀 이동금액(+)</th>
      <th>Pot Before</th>
      <th>Pot Used</th>
      <th>Pot Remain</th>
      <th>Skin Winner</th>
    </tr>
  </thead>
  <tbody id="bodyRows"></tbody>
</table>

<table class="totals">
  <tr>
    <th></th>
    <th id="sumA">A</th>
    <th id="sumB">B</th>
    <th id="sumC">C</th>
    <th id="sumD">D</th>
  </tr>
  <tr>
    <th>머니 합계($)</th>
    <td id="totalA"></td>
    <td id="totalB"></td>
    <td id="totalC"></td>
    <td id="totalD"></td>
  </tr>
  <tr>
    <th>타수 합계</th>
    <td id="strokesA"></td>
    <td id="strokesB"></td>
    <td id="strokesC"></td>
    <td id="strokesD"></td>
  </tr>
  <tr>
    <th>파 대비</th>
    <td id="vsParA"></td>
    <td id="vsParB"></td>
    <td id="vsParC"></td>
    <td id="vsParD"></td>
  </tr>
</table>

<div class="note">
  • 머니 게임을 안 하고 스트로크 게임만 할 때는, 위의 금액(타당/보너스/스킨)을 0으로 놓고 “타수 합계 / 파 대비”만 보고 쓰면 됩니다.<br>
  • 기본 타당 = 평상시 1타당 금액 (기본 2달러).<br>
  • 특수홀 배율 = 전 홀 버디 이상 / 트리플 이상 / 4명 동타일 때 다음 홀에 곱해지는 배율 (기본 2배 → 4달러).<br>
  • 버디/이글 보너스, 스킨 값도 위에서 원하는 금액으로 변경 가능합니다.<br>
  • 숫자를 바꾸거나 스코어를 입력하면 자동으로 다시 계산됩니다.<br>
</div>

<script>
  // 행 생성
  const body = document.getElementById("bodyRows");
  for (let h = 1; h <= 18; h++) {
    body.innerHTML += `
      <tr>
        <td>${h}</td>
        <td><input type="number" id="par_${h}" value="4"></td>
        <td><input type="number" id="A_${h}"></td>
        <td><input type="number" id="B_${h}"></td>
        <td><input type="number" id="C_${h}"></td>
        <td><input type="number" id="D_${h}"></td>
        <td id="rate_${h}"></td>
        <td id="netA_${h}"></td>
        <td id="netB_${h}"></td>
        <td id="netC_${h}"></td>
        <td id="netD_${h}"></td>
        <td id="moved_${h}"></td>
        <td id="potBefore_${h}"></td>
        <td id="potUsed_${h}"></td>
        <td id="potRemain_${h}"></td>
        <td id="skinWinner_${h}"></td>
      </tr>`;
  }

  function getNames() {
    return [
      document.getElementById("nameA").value.trim() || "A",
      document.getElementById("nameB").value.trim() || "B",
      document.getElementById("nameC").value.trim() || "C",
      document.getElementById("nameD").value.trim() || "D"
    ];
  }

  function updateNames() {
    const [nA, nB, nC, nD] = getNames();
    document.getElementById("thA").innerText = nA;
    document.getElementById("thB").innerText = nB;
    document.getElementById("thC").innerText = nC;
    document.getElementById("thD").innerText = nD;

    document.getElementById("thNetA").innerText = nA + " Net";
    document.getElementById("thNetB").innerText = nB + " Net";
    document.getElementById("thNetC").innerText = nC + " Net";
    document.getElementById("thNetD").innerText = nD + " Net";

    document.getElementById("sumA").innerText = nA;
    document.getElementById("sumB").innerText = nB;
    document.getElementById("sumC").innerText = nC;
    document.getElementById("sumD").innerText = nD;
  }

  ["nameA","nameB","nameC","nameD"].forEach(id => {
    document.getElementById(id).addEventListener("input", () => {
      updateNames();
      calcAll();
    });
  });
  updateNames();

  function toggleFullscreen() {
    if (!document.fullscreenElement) {
      document.documentElement.requestFullscreen();
    } else {
      document.exitFullscreen();
    }
  }

  function takeScreenshot() {
    html2canvas(document.getElementById("captureArea")).then(canvas => {
      const link = document.createElement("a");
      link.download = "golf_result.png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    });
  }

  function formatVsPar(diff) {
    if (isNaN(diff)) return "";
    if (diff === 0) return "E";
    if (diff > 0) return "+" + diff;
    return diff.toString();
  }

  function calcAll() {
    const baseStake = parseFloat(document.getElementById("baseStake").value) || 0;
    const rateMult  = parseFloat(document.getElementById("rateMultiplier").value) || 1;
    const birdieBonus = parseFloat(document.getElementById("birdieBonus").value) || 0;
    const eagleBonus  = parseFloat(document.getElementById("eagleBonus").value) || 0;
    const skinValue   = parseFloat(document.getElementById("skinValue").value) || 0;

    let totalA = 0, totalB = 0, totalC = 0, totalD = 0;
    let strokesA = 0, strokesB = 0, strokesC = 0, strokesD = 0;
    let totalPar = 0;

    let prevScores = null, prevPar = null, potRemainPrev = 0;

    const names = getNames();

    for (let h = 1; h <= 18; h++) {
      const par = parseFloat(document.getElementById('par_' + h).value);
      const sA = parseFloat(document.getElementById('A_' + h).value);
      const sB = parseFloat(document.getElementById('B_' + h).value);
      const sC = parseFloat(document.getElementById('C_' + h).value);
      const sD = parseFloat(document.getElementById('D_' + h).value);
      const scores = [sA, sB, sC, sD];

      const allScoresFilled = scores.every(v => !isNaN(v));
      if (!allScoresFilled || isNaN(par)) {
        // 뒤 홀은 비워둔 상태로 간주하고 중단
        break;
      }

      // 스트로크 합계/파 합계 누적 (스트로크 게임용)
      strokesA += sA;
      strokesB += sB;
      strokesC += sC;
      strokesD += sD;
      totalPar += par;

      // 타당 금액(ratePerStroke) 계산
      let ratePerStroke = baseStake;
      if (h === 1) {
        ratePerStroke = baseStake;
      } else if (prevScores && prevPar != null) {
        const hasBirdieOrBetter = prevScores.some(x => x <= prevPar - 1);
        const hasTripleOrWorse = prevScores.some(x => x >= prevPar + 3);
        const allSame = prevScores.every(x => x === prevScores[0]);
        ratePerStroke = (hasBirdieOrBetter || hasTripleOrWorse || allSame)
          ? baseStake * rateMult
          : baseStake;
      }
      document.getElementById('rate_' + h).innerText = ratePerStroke.toFixed(1);

      // 기본 타수차 Net (pairwise, 머니게임용)
      let net = [0, 0, 0, 0];
      for (let i = 0; i < 4; i++) {
        for (let j = i + 1; j < 4; j++) {
          const diff = (scores[j] - scores[i]) * ratePerStroke;
          net[i] += diff;
          net[j] -= diff;
        }
      }

      // 버디 보너스 (par-1)
      const totalBirdies = scores.filter(s => s === par - 1).length;
      if (totalBirdies > 0 && birdieBonus !== 0) {
        for (let i = 0; i < 4; i++) {
          const isBirdie = (scores[i] === par - 1);
          if (isBirdie) {
            net[i] += (4 - totalBirdies) * birdieBonus;
          } else {
            net[i] -= totalBirdies * birdieBonus;
          }
        }
      }

      // 이글 보너스 (par-2 이하)
      const totalEagles = scores.filter(s => s <= par - 2).length;
      if (totalEagles > 0 && eagleBonus !== 0) {
        for (let i = 0; i < 4; i++) {
          const isEagle = (scores[i] <= par - 2);
          if (isEagle) {
            net[i] += (4 - totalEagles) * eagleBonus;
          } else {
            net[i] -= totalEagles * eagleBonus;
          }
        }
      }

      // 스킨 계산 (이월 + 최대 3홀치)
      const potBefore = potRemainPrev + 1;
      let potUsed = 0;
      let potRemain = potBefore;
      let skinWinnerIdx = -1;

      const minScore = Math.min(...scores);
      const minIndices = [];
      for (let i = 0; i < 4; i++) {
        if (scores[i] === minScore) minIndices.push(i);
      }

      if (minIndices.length === 1 && minScore <= par && skinValue !== 0) {
        skinWinnerIdx = minIndices[0];
        potUsed = Math.min(potBefore, 3);
        potRemain = potBefore - potUsed;

        for (let i = 0; i < 4; i++) {
          if (i === skinWinnerIdx) {
            net[i] += 3 * potUsed * skinValue;
          } else {
            net[i] -= potUsed * skinValue;
          }
        }
      } else {
        potUsed = 0;
        potRemain = potBefore;
      }
      potRemainPrev = potRemain;

      // 이 홀 결과 표시
      const [nA, nB, nC, nD] = net;
      document.getElementById('netA_' + h).innerText = nA.toFixed(0);
      document.getElementById('netB_' + h).innerText = nB.toFixed(0);
      document.getElementById('netC_' + h).innerText = nC.toFixed(0);
      document.getElementById('netD_' + h).innerText = nD.toFixed(0);

      const moved = [nA, nB, nC, nD].filter(v => v > 0).reduce((a, b) => a + b, 0);
      document.getElementById('moved_' + h).innerText = moved.toFixed(0);
      document.getElementById('potBefore_' + h).innerText = potBefore.toFixed(0);
      document.getElementById('potUsed_' + h).innerText = potUsed.toFixed(0);
      document.getElementById('potRemain_' + h).innerText = potRemain.toFixed(0);
      document.getElementById('skinWinner_' + h).innerText =
        (skinWinnerIdx >= 0 ? names[skinWinnerIdx] : '');

      totalA += nA;
      totalB += nB;
      totalC += nC;
      totalD += nD;

      prevScores = scores;
      prevPar = par;
    }

    // 머니 합계
    document.getElementById('totalA').innerText = totalA.toFixed(0);
    document.getElementById('totalB').innerText = totalB.toFixed(0);
    document.getElementById('totalC').innerText = totalC.toFixed(0);
    document.getElementById('totalD').innerText = totalD.toFixed(0);

    // 스트로크 합계 및 파 대비
    if (totalPar > 0) {
      document.getElementById('strokesA').innerText = strokesA || "";
      document.getElementById('strokesB').innerText = strokesB || "";
      document.getElementById('strokesC').innerText = strokesC || "";
      document.getElementById('strokesD').innerText = strokesD || "";

      document.getElementById('vsParA').innerText = formatVsPar(strokesA - totalPar);
      document.getElementById('vsParB').innerText = formatVsPar(strokesB - totalPar);
      document.getElementById('vsParC').innerText = formatVsPar(strokesC - totalPar);
      document.getElementById('vsParD').innerText = formatVsPar(strokesD - totalPar);
    } else {
      document.getElementById('strokesA').innerText = "";
      document.getElementById('strokesB').innerText = "";
      document.getElementById('strokesC').innerText = "";
      document.getElementById('strokesD').innerText = "";
      document.getElementById('vsParA').innerText = "";
      document.getElementById('vsParB').innerText = "";
      document.getElementById('vsParC').innerText = "";
      document.getElementById('vsParD').innerText = "";
    }
  }

  // 숫자 입력이 바뀔 때마다 자동 계산
  function attachAutoCalc() {
    const numberInputs = document.querySelectorAll('input[type="number"]');
    numberInputs.forEach(el => {
      el.addEventListener('input', calcAll);
    });
  }

  attachAutoCalc();
  calcAll();
</script>

</body>
</html>
